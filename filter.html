<!DOCTYPE html>
<html>
  <head>
    <title>Checkerify</title>
  <meta charset="UTF-8">
  <meta name="google" content="notranslate">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" src="bsae.css">
    <style>
canvas{
position: relative;
margin-top: 5px;
border: 1px solid black;
z-index: -1;
  image-rendering: pixelated;
  image-rendering: crispy-edges;
}

a{
display: none;
}

button{
margin-top: 2cqw;
z-index: 1;
}

input{
z-index: 1;
}

body{
margin: 0px;
}
    </style>
    <script>
var fileName = "";
var effectNames = "";

function filter(filterName, arg){
const c = document.querySelector("canvas");
const ctx = c.getContext("2d");
const imgData = ctx.getImageData(0, 0, c.width, c.height);
const data = imgData.data;
switch(filterName){
case "checkeredInvert":
for(let i = 0; i < data.length; i+=4){
const x = i / 4 % imgData.width;
const y = Math.floor(i / 4 / imgData.width);
if((x+y)%2){
for(let j = 0; j < 3; j++){
data[i+j] = 255 - data[i+j];
}
}
}
effectNames += "Checkered-Inverted";
break;
case "invert":
for(let i = 0; i < data.length; i+=4){
const x = i / 4 % imgData.width;
const y = Math.floor(i / 4 / imgData.width);
for(let j = 0; j < 3; j++){
data[i+j] = 255 - data[i+j];
}
}
effectNames += "Inverted";
break;
case "color":
for(let i = 0; i < data.length; i+=4){
const x = i / 4 % imgData.width;
const y = Math.floor(i / 4 / imgData.width);
data[i+arg] = data[i+arg] + 64 > 255 ? 255 : data[i+arg] + 64;
}
effectNames += (arg==0?"Red-":arg==1?"Blue-":"Green-") + "Stained";
break;
case "boost":
for(let i = 0; i < data.length; i+=4){
const x = i / 4 % imgData.width;
const y = Math.floor(i / 4 / imgData.width);
for(let j = 0; j < 3; j++){
data[i+j] = Math.round((data[i+j] + 1) / (256/arg)) * (256/arg) - 1;
}
}
effectNames += (arg + 1) ** 3 + "-Boosted";
break;
case "monochromatic":
for(let i = 0; i < data.length; i+=4){
const x = i / 4 % imgData.width;
const y = Math.floor(i / 4 / imgData.width);
var avg = (data[i] + data[i+1] + data[i+2]) / 3;
for(let j = 0; j < 3; j++) data[i+j] = avg;
}
effectNames += "Monochromaticed";
break;
case "grain":
for(let i = 0; i < data.length; i+=4){
const x = i / 4 % imgData.width;
const y = Math.floor(i / 4 / imgData.width);
var grainOffset = Math.floor(Math.random() * 65) - 32;
for(let j = 0; j < 3; j++) data[i+j] -= grainOffset;
}
effectNames += "Grained";
break;
case "lowQuality":
const fitToScreen = document.querySelectorAll("input[type=checkbox]")[1].checked;
const img = new Image();
img.src = c.toDataURL();
img.onload = ()=>{
c.width = img.width/2;
c.height = img.height/2;
ctx.drawImage(img, 0, 0, c.width, c.height);
const resolution = (window.screen.availWidth-2)/img.width;
c.style.width = img.width * (fitToScreen?resolution:1)+"px";
c.style.height = img.height * (fitToScreen?resolution:1)+"px";
}
effectNames += "LowQualityfied";
return;
break;
case "night":
for(let i = 0; i < data.length; i+=4){
for(let j = 0; j < 3; j++) data[i+j] = Math.floor(data[i+j]**6.25)>255?255:Math.floor(data[i+j]**6.25);
}
effectNames += "NightVisioned";
break;
}
ctx.putImageData(imgData, 0, 0);
}

function loadImg(){
const input = document.querySelector("input");
const reader = new FileReader();
const img = new Image();
const c = document.querySelector("canvas");
const ctx = c.getContext("2d");
const loadLow = document.querySelector("input[type=checkbox]").checked;
const fitToScreen = document.querySelectorAll("input[type=checkbox]")[1].checked;
reader.onload = ()=>{
img.src = reader.result;
}
img.onload = ()=>{
c.width = img.width/(loadLow?10:1);
c.height = img.height/(loadLow?10:1);
const resolution = (window.screen.availWidth-2)/img.width;
c.style.width = img.width * (fitToScreen?resolution:1)+"px";
c.style.height = img.height * (fitToScreen?resolution:1)+"px";
ctx.clearRect(0, 0, c.width, c.height);
ctx.drawImage(img, 0, 0, c.width, c.height);
}
reader.readAsDataURL(input.files[0]);
fileName = input.files[0].name.split(".")[0];
effectNames = "";
}

function download(){
var a = document.querySelector("a");
a.href = document.querySelector("canvas").toDataURL();
a.download = effectNames + fileName;
a.click();
}
</script>
  </head>
  <body>
<input type="file" oninput="loadImg()"/>
<button onclick="loadImg()">Reload</button>
<br>
<label>Load Low Quality: </label>
<input type="checkbox">
<br>
<label>Fit to Screen: </label>
<input type="checkbox" checked="true">
<br>
<button onclick="filter('invert')">Invert</button>
<button onclick="filter('checkeredInvert')">Checkered Invert</button>
<br>
<button onclick="filter('color', 0)">Red</button>
<button onclick="filter('color', 1)">Green</button>
<button onclick="filter('color', 2)">Blue</button>
<button onclick="filter('monochromatic')">Monochromatic</button>
<br>
<button onclick="filter('boost', 1)">Boost 8</button>
<button onclick="filter('boost', 2)">Boost 27</button>
<button onclick="filter('boost', 4)">Boost 125</button>
<br>
<button onclick="filter('grain')">Grain</button>
<button onclick="filter('lowQuality')">Low Quality</button>
<button onclick="filter('night')">Night Vision</button>
<br>
<button onclick="download()">Download</button>
<a download>Download</a>
<br>
<canvas></canvas>
  </body>
</html>
