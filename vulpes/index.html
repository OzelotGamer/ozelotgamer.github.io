<!DOCTYPE html>
<html>

<head>
  <title>Speechbubble</title>
  <meta charset="UTF-8">
  <meta name="google" content="notranslate">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /*Default Settings*/
    :root {
      font-size: 2.5vmin;
      --sb-bg-color: #401080;
      --sb-border-color: #200040;
      --sb-speed: 2s;
      --sb-text-color: #edf;
      overflow: hidden;
    }

    /*Speechbubble main body*/
    .sb {
      background-color: var(--sb-bg-color);
      border: .25rem solid var(--sb-border-color);
      border-radius: 1rem;
      color: var(--sb-text-color);
      width: fit-content;
      padding: .5rem 1.5rem;
      transition: var(--sb-speed);
      transform: translate(-125%, 0%);
      min-width: 1.5rem;
    }

    /*Speechbubble bg triangle*/
    .sb:after {
      content: '';
      position: absolute;
      bottom: -.95rem;
      right: 1rem;
      border-left: 1rem solid transparent;
      border-right: 1rem solid transparent;
      border-top: 1rem solid var(--sb-bg-color);
      transition: var(--sb-speed);
      transform: skewX(60deg);
    }

    /*Speechbubble border triangle*/
    .sb:before {
      content: '';
      position: absolute;
      bottom: -1.35rem;
      right: .5rem;
      border-left: 1.25rem solid transparent;
      border-right: 1.25rem solid transparent;
      border-top: 1.25rem solid var(--sb-border-color);
      transition: var(--sb-speed);
      transform: skewX(60deg);
    }

    label {
      font-size: 1vmin;
      line-height: 1vmin;
      margin-right: 1vmin;
    }

    .options {
      display: none;
      line-height: 2.5vmin;
      font-size: 0px;
      bottom: 0;
      position: absolute;
    }

    textarea{
      resize: none;
      width: 25vmin;
    }

    .link{
      font-size: 1vmin;
      font-weight: 900;
      transition: .1s;
      max-width: 90%;
      text-align: center;
      cursor: pointer;
      user-select: none;
      &:active{
        transform: scale(1.2);
      }
    }

    .madefor{
      color: #aaa;
      filter: opacity(.1);
      font-size: 5vmin;
      text-align: center;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-shadow: #200040 .2vmin .2vmin;
      user-select: none;
      cursor: pointer;
      text-decoration: none;
      display: none;
    }
  </style>
  <script>
    var inMinInterval = 60;
    var inMaxInterval = 120;
    var outMinInterval = 10;
    var outMaxInterval = 15;
    var messages = ["a","bb","ccc"];

    document.addEventListener("DOMContentLoaded", () => {
      function sbin(){
        document.querySelector(".sb").innerHTML = messages[Math.floor(Math.random()*messages.length)];
        document.querySelector(".sb").style.transform = "translate(0%, 0%)";
        setTimeout(sbout, (Math.floor(Math.random() * (outMaxInterval - outMinInterval)) + outMinInterval)*1000);
      }

      function sbout(){
        document.querySelector(".sb").style.transform = "translate(-125%, 0%)";
        setTimeout(sbin, (Math.floor(Math.random() * (inMaxInterval - inMinInterval)) + inMinInterval)*1000);
      }
      setTimeout(() => {
        if(location.search){
          const data = JSON.parse(atob(location.search.substring(1)));
          document.documentElement.style.cssText = `
          font-size: ${data.fontSize}vmin;
          --sb-bg-color: ${data.bgcol};
          --sb-border-color: ${data.bordercol};
          --sb-text-color: ${data.textcol};
          --sb-speed: ${data.speed}s;
          `;
          inMinInterval = data.inMinInterval;
          inMaxInterval = data.inMaxInterval;
          outMaxInterval = data.outMaxInterval;
          outMinInterval = data.outMinInterval;
          messages = data.messages;
        }
        else{
          document.querySelector(".options").style.display = "block";
          document.querySelector(".madefor").style.display = "block";
        }
        sbin();
      }, 500);
    });

    function updateSb(){
      const opts = document.querySelectorAll(".options input, .options textarea");
      const data = {
        fontSize: opts[0].value?opts[0].value:2.5,
        bgcol: opts[1].value?opts[1].value:"#401080",
        bordercol: opts[2].value?opts[2].value:"#200040",
        textcol: opts[3].value?opts[3].value:"#eeddff",
        speed: opts[4].value?opts[4].value:2,
        inMinInterval: opts[5].value?opts[5].value:60,
        inMaxInterval: opts[6].value?opts[6].value:120,
        outMinInterval: opts[7].value?opts[7].value:10,
        outMaxInterval: opts[8].value?opts[8].value:15,
        messages: opts[9].value?opts[9].value.split(/\r?\n/):["placeholder1","placeholder2","placeholder3"]
      }
      document.documentElement.style.cssText = `
      font-size: ${data.fontSize}vmin;
      --sb-bg-color: ${data.bgcol};
      --sb-border-color: ${data.bordercol};
      --sb-text-color: ${data.textcol};
      --sb-speed: ${data.speed}s;
      `;
      inMinInterval = data.inMinInterval;
      inMaxInterval = data.inMaxInterval;
      outMinInterval = data.outMinInterval;
      outMaxInterval = data.outMaxInterval;
      messages = data.messages;
      document.querySelector(".options div").innerHTML = location.href + "?" + btoa(JSON.stringify(data));
    }

    function resize(ta){
      ta.style.height = "0";
      ta.style.height = ta.scrollHeight + "px";
    }
  </script>
</head>

<body>
  <div class="sb"></div>
  <div class="options">
    <div class="link" onclick="navigator.clipboard.writeText(this.innerHTML)">Final link goes here (Click to copy)</div>
    <label for="size">Size:</label>
    <input type="number" placeholder="Default: 2.5" id="size" oninput="updateSb()"/>
    <br>
    <label for="bgCol">Background Color:</label>
    <input type="color" id="bgCol" value="#401080" oninput="updateSb()"/>
    <br>
    <label for="borderCol">Border Color:</label>
    <input type="color" id="borderCol" value="#200040" oninput="updateSb()"/>
    <br>
    <label for="textCol">Text Color:</label>
    <input type="color" id="textCol" value="#eeddff" oninput="updateSb()"/>
    <br>
    <label for="textCol">Speechbubble Animation Speed:</label>
    <input type="number" placeholder="Default: 2" id="textCol" value="2" oninput="updateSb()"/>
    <br>
    <label for="sShowUpTime">Shortest possible time for Speechbubble to show up (in seconds):</label>
    <input type="number" placeholder="Default: 60" id="sShowUpTime" oninput="updateSb()"/>
    <br>
    <label for="lShowUpTime">Longest possible time for Speechbubble to show up (in seconds):</label>
    <input type="number" placeholder="Default: 120" id="lShowUpTime" oninput="updateSb()"/>
    <br>
    <label for="sAwayTime">Shortest possible time for Speechbubble to go away (in seconds):</label>
    <input type="number" placeholder="Default: 10" id="sAwayTime" oninput="updateSb()"/>
    <br>
    <label for="lAwayTime">Longest possible time for Speechbubble to go away (in seconds):</label>
    <input type="number" placeholder="Default: 15" id="lAwayTime" oninput="updateSb()"/>
    <br>
    <label for="messages">Messages (1 Message = 1 Line):</label>
    <textarea oninput="updateSb();resize(this);" id="messages" placeholder="a&#10;bb&#10;ccc"></textarea>
  </div>
  <a class="madefor" href="https://www.twitch.tv/vulpes_hex">Made for Vulpes_Hex with &#10084;&#65039;</a>
</body>

</html>
